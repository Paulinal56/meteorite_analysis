---
title: "Analiza Meteorów NASA"
author: "Paulina Papież i Julia Bugielska"
date: "`r Sys.Date()`"
output: html_document
---

## Wprowadzenie

W raporcie przedstawiamy analizę danych NASA dotyczących meteorów z lat 1900–2000.  
Celem jest zobrazowanie liczby meteorów w czasie, ich rozmieszczenia geograficznego oraz charakterystyki masy i klasy.

## O danych

Dane pochodzą z publicznej bazy NASA (Meteorite Landings). Zawierają rekordy odnalezionych i obserwowanych meteorów — m.in. nazwę, rok, masę (w gramach) oraz współrzędne geograficzne miejsca znalezienia lub upadku. Analizujemy rekordy z lat 1900–2000.

## Metody analizy

- Wczytanie lokalnego pliku CSV z danymi.  
- Konwersja pola `year` na typ liczbowy.  
- Filtrowanie rekordów na lata 1900–2000.  
- Przygotowanie interaktywnej tabeli (DT), mapy (leaflet) oraz wykresów (plotly).  
- Podział meteorytów na 5 grup masowych według kwantyli.  
- Analiza trendów i wizualizacja wyników statystycznych.

## Ciekawostki

Najcięższy meteoryt z lat 1900–2000 ważył X g i został znaleziony w miejsce/rok.

Najczęściej występująca klasa meteorytów w analizowanym okresie to Klasa Y.

Najwięcej meteorów odnotowano w dekadzie 19ZZ–19ZZ.

Większość meteorów pochodzi z typów Fell lub Found.

## Wnioski

Liczba meteorów obserwowanych w XX wieku wzrastała stopniowo z upływem dekad.

Średnia masa meteorów jest zróżnicowana, a ekstremalnie ciężkie okazy są rzadkie.

Rozmieszczenie geograficzne wskazuje na różnice w liczbie odnalezionych meteorów między regionami.

Analiza klas i typów meteorytów pozwala wnioskować o różnorodności materiałów i ich pochodzeniu.

---

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Ładujemy potrzebne biblioteki
library(tidyverse)
library(leaflet)
library(DT)
library(scales)
library(RColorBrewer)
library(htmltools)
library(knitr)
library(plotly)

# Wczytanie danych
meteorites <- read.csv("C:/Users/1/Documents/meteorite_analysis/meteorite-landings.csv",
                       stringsAsFactors = FALSE)

# Zamieniamy rok na typ liczbowy
meteorites$year <- suppressWarnings(as.numeric(substr(meteorites$year, 1, 4)))

# Polskie nazwy kolumn
colnames(meteorites) <- c("Nazwa", "ID", "Typ", "Klasa", "Masa_g", "Upadek", "Rok", "Szer_geo", "Dł_geo", "Pozycja")

# Poprawiamy współrzędne geograficzne
meteorites <- meteorites %>% mutate(
  Szer_geo = as.numeric(Szer_geo),
  Dł_geo   = as.numeric(Dł_geo)
)

# Opisy współrzędnych w czytelnej formie
meteorites <- meteorites %>% mutate(
  Szer_geo_opis = case_when(
    !is.na(Szer_geo) & Szer_geo > 0  ~ paste0(round(Szer_geo, 4), "°N"),
    !is.na(Szer_geo) & Szer_geo < 0  ~ paste0(abs(round(Szer_geo, 4)), "°S"),
    TRUE ~ NA_character_
  ),
  Dl_geo_opis = case_when(
    !is.na(Dł_geo) & Dł_geo > 0  ~ paste0(round(Dł_geo, 4), "°E"),
    !is.na(Dł_geo) & Dł_geo < 0  ~ paste0(abs(round(Dł_geo, 4)), "°W"),
    TRUE ~ NA_character_
  )
)

# Filtrujemy lata 1900-2000
meteor_filtered <- meteorites %>% filter(!is.na(Rok) & Rok >= 1900 & Rok <= 2000)
meteor_map <- meteor_filtered %>% filter(!is.na(Szer_geo) & !is.na(Dł_geo) & !is.na(Masa_g))

# Dzielimy meteoryty na 5 grup masowych
meteor_map <- meteor_map %>% mutate(
  Masa_grupa = cut(
    Masa_g,
    breaks = quantile(Masa_g, probs = seq(0, 1, 0.2), na.rm = TRUE),
    labels = c("Bardzo małe", "Małe", "Średnie", "Duże", "Bardzo duże"),
    include.lowest = TRUE
  )
)

# Kolory dla grup masowych
pal_group <- colorFactor(palette = brewer.pal(5, "YlOrRd"), domain = meteor_map$Masa_grupa)

# 1) Tabela interaktywna
datatable(
  meteor_filtered %>% select(Nazwa, Klasa, Masa_g, Rok, Szer_geo_opis, Dl_geo_opis, Pozycja),
  colnames = c("Nazwa meteoru", "Klasa", "Masa (g)", "Rok", "Szerokość geograficzna", "Długość geograficzna", "Pozycja"),
  rownames = FALSE,
  options = list(
    pageLength = 10,
    language = list(search = "Szukaj:"),
    stripeClasses = c('odd-row', 'even-row'),
    autoWidth = TRUE
  )
) %>% htmlwidgets::prependContent(htmltools::tags$h3("Tabela: wybrane rekordy meteorów (1900–2000)"))

# 2) Czytelna mapa z logarytmicznie skalowanymi punktami
leaflet(meteor_map) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(
    lng = ~Dł_geo, lat = ~Szer_geo,
    color = ~pal_group(Masa_grupa),
    radius = ~log10(Masa_g + 1) * 2,   # logarytmicznie skalowane promienie
    stroke = TRUE,
    weight = 1,
    fillOpacity = 0.6,                 # przezroczystość dla lepszej widoczności
    popup = ~paste0(
      "<b>Nazwa:</b> ", Nazwa, "<br>",
      "<b>Klasa:</b> ", Klasa, "<br>",
      "<b>Masa:</b> ", formatC(Masa_g, format = "d", big.mark = " "), " g<br>",
      "<b>Rok:</b> ", Rok, "<br>",
      "<b>Szerokość:</b> ", Szer_geo_opis, "<br>",
      "<b>Długość:</b> ", Dl_geo_opis, "<br>",
      "<b>Lokalizacja:</b> ", Pozycja
    )
  ) %>%
  addLegend("bottomright", pal = pal_group, values = ~Masa_grupa,
            title = "Grupy mas meteorów") %>%
  htmlwidgets::prependContent(htmltools::tags$h3("Mapa: lokalizacje meteorów"))

# 3) Liczba meteorów co 10 lat
decade_counts <- meteor_filtered %>%
  mutate(Rok_grupa = Rok - Rok %% 10) %>%
  group_by(Rok_grupa) %>% summarise(Liczba = n())
plot_ly(decade_counts, x=~Rok_grupa, y=~Liczba, type='bar', text=~Liczba, textposition='auto',
        marker=list(color=~Liczba, colorscale='Oranges')) %>%
  layout(title="Liczba meteorów (co 10 lat)", xaxis=list(title="Dekada"), yaxis=list(title="Liczba"))

# 4) Top 10 klas meteorów
top10 <- meteor_filtered %>%
  group_by(Klasa) %>% summarise(Liczba = n()) %>%
  arrange(desc(Liczba)) %>% slice_head(n=10)
plot_ly(top10, x=~Liczba, y=~reorder(Klasa, Liczba), type='bar', orientation='h', text=~Liczba, textposition='auto',
        marker=list(color=~Liczba, colorscale='Purples')) %>%
  layout(title="Top 10 klas meteorów", xaxis=list(title="Liczba przypadków"), yaxis=list(title="Klasa"))

# 5) Trend średniej masy w dekadach
mass_trend <- meteor_filtered %>%
  mutate(Rok_grupa = Rok - Rok %% 10) %>%
  group_by(Rok_grupa) %>%
  summarise(Średnia_masa = mean(Masa_g, na.rm = TRUE))

plot_ly(mass_trend, x = ~Rok_grupa, y = ~Średnia_masa, type='scatter', mode='lines+markers',
        marker = list(color = 'red')) %>%
  layout(title="Średnia masa meteorów w dekadach",
         xaxis=list(title="Dekada"),
         yaxis=list(title="Średnia masa [g]"))

# 6) Top 10 największych meteorów
top_mass <- meteor_filtered %>%
  arrange(desc(Masa_g)) %>% slice_head(n = 10) %>%
  select(Nazwa, Klasa, Masa_g, Rok, Pozycja)

knitr::kable(top_mass, caption="10 największych meteorów 1900–2000")

# 7) Podstawowe statystyki
stats <- meteor_filtered %>%
  summarise(
    `Liczba wszystkich rekordów` = n(),
    `Liczba rekordów z poprawnymi współrzędnymi` = sum(!is.na(Szer_geo) & !is.na(Dł_geo)),
    `Mediana masy meteoru [g]` = median(Masa_g, na.rm=TRUE),
    `Średnia masa meteoru [g]` = round(mean(Masa_g, na.rm=TRUE),2)
  )
knitr::kable(stats, caption="Podstawowe statystyki meteorów dla lat 1900–2000")
